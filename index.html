<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dark Themed Web App</title>

  <!-- Google Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <style>
    /* === Global Styles === */
    :root {
      --bg-color: #1e1e1e;
      --fg-color: #f0f0f0;
      --accent-color: #2d2d2d;
      --border-radius: 8px;
      --skeleton-color: #2a2a2a;
      --skeleton-highlight: #3a3a3a;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      outline: none;
      font-family: sans-serif;
    }
    body {
      background-color: var(--bg-color);
      color: var(--fg-color);
      margin: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      /* For DPAD testing, ensure focus ring is visible: */
      /* Outline only on keyboard navigation (optional) */
    }
    button, a, input {
      color: var(--fg-color);
      background: var(--accent-color);
      border: none;
      border-radius: var(--border-radius);
      padding: 0.5rem 1rem;
      cursor: pointer;
    }
    button:focus,
    [tabindex]:focus {
      outline: 2px solid #888;
    }

    /* === Container for the entire app === */
    .app-container {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* === Tabs Bar === */
    .tabs {
      display: flex;
      justify-content: flex-start;
      background: var(--accent-color);
      padding: 0.5rem;
      border-radius: var(--border-radius);
      margin: 0.5rem;
      gap: 0.5rem;
    }
    .tab-button {
      flex: 0 0 auto;
      border-radius: var(--border-radius);
      padding: 0.5rem 1rem;
      background: #333;
      color: var(--fg-color);
      border: none;
      cursor: pointer;
    }
    .tab-button.active {
      background: #444;
    }

    /* === Body container for each tab’s content === */
    .tab-content {
      flex: 1;
      margin: 0.5rem;
      background: var(--accent-color);
      border-radius: var(--border-radius);
      padding: 1rem;
      display: none; /* hidden by default */
    }
    .tab-content.active {
      display: block;
    }

    /* ================================
       SAVED TAB
       ================================ */
    .saved-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    .saved-logo {
      margin-top: 1rem;
      font-size: 2rem;
      border: 2px dashed #666;
      width: 200px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--border-radius);
    }
    .quick-links {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
    }
    .quick-link {
      width: 80px;
      text-align: center;
      border-radius: var(--border-radius);
      background: #333;
      padding: 0.5rem;
      cursor: pointer;
      user-select: none;
    }
    .quick-link:focus {
      outline: 2px solid #888;
    }
    .quick-link .icon-container {
      width: 40px;
      height: 40px;
      margin: 0 auto;
      border-radius: 50%;
      background: #555;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.25rem;
    }
    .quick-link img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 50%;
    }
    .quick-link .ql-text {
      font-size: 0.75rem;
    }
    .customise-btn {
      margin-top: 1rem;
      background: #444;
    }

    /* Dragging Styles (while in edit mode) */
    .quick-link.dragging {
      opacity: 0.5;
    }
    .drop-zone {
      border: 2px dashed #666;
      margin: 1rem;
      padding: 1rem;
      display: none;
    }
    .drop-zone.edit-mode {
      display: block;
    }

    /* Skeleton Loading Animation */
    @keyframes skeleton-loading {
      0% {
        background-color: var(--skeleton-color);
      }
      100% {
        background-color: var(--skeleton-highlight);
      }
    }
    .skeleton {
      border-radius: var(--border-radius);
      animation: skeleton-loading 1s linear infinite alternate;
    }
    /* Skeleton placeholders for quick links (Saved tab) */
    .quick-link.skeleton {
      width: 80px;
      height: 60px;
    }

    /* ================================
       LIVE TAB
       ================================ */
    .live-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }
    .live-tile {
      background: #333;
      border-radius: var(--border-radius);
      padding: 0.5rem;
      cursor: pointer;
    }
    .live-tile:focus {
      outline: 2px solid #888;
    }
    .live-tile-img {
      width: 100%;
      height: 100px;
      background: #555;
      margin-bottom: 0.5rem;
      border-radius: var(--border-radius);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .live-tile-img img {
      width: 100%;
      height: auto;
    }
    .live-tile-title {
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }
    .live-tile-meta {
      font-size: 0.7rem;
      color: #aaa;
    }
    /* Skeleton placeholders for Live tab */
    .live-tile.skeleton .live-tile-img {
      animation: skeleton-loading 1s linear infinite alternate;
    }
    .live-tile.skeleton .live-tile-title,
    .live-tile.skeleton .live-tile-meta {
      background: var(--skeleton-color);
      animation: skeleton-loading 1s linear infinite alternate;
    }

    /* ================================
       NOTES TAB
       ================================ */
    .notes-content {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      font-size: 1.2rem;
      color: #888;
    }

    /* ================================
       MODAL (for Password)
       ================================ */
    .modal-backdrop {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal {
      background: var(--accent-color);
      padding: 1rem;
      border-radius: var(--border-radius);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 300px;
    }
    .modal input {
      width: 100%;
      padding: 0.5rem;
      border-radius: var(--border-radius);
      border: 1px solid #444;
      background: #222;
      color: #fff;
    }

  </style>
</head>
<body>

<div class="app-container">

  <!-- TABS -->
  <div class="tabs">
    <button class="tab-button active" data-tab="saved" tabindex="1">Saved</button>
    <button class="tab-button" data-tab="live"  tabindex="2">Live</button>
    <button class="tab-button" data-tab="notes" tabindex="3">Notes</button>
  </div>

  <!-- TAB CONTENTS -->
  <!-- 1. Saved Tab -->
  <div class="tab-content active" id="savedTab">
    <div class="saved-content">
      <!-- The “SVG Logo” area -->
      <div class="saved-logo" id="savedLogo" tabindex="-1">
        SVG Logo
      </div>

      <!-- Quick Links Grid -->
      <div class="quick-links" id="quickLinks">
        <!-- Populated by JS or skeleton placeholders -->
      </div>

      <!-- Drop Zone for reordering (visible in edit mode) -->
      <div class="drop-zone" id="dropZone">
        <p>Drag & drop to reorder your links</p>
      </div>

      <!-- Customise button -->
      <button class="customise-btn" id="customiseBtn" tabindex="4">
        <span class="material-symbols-outlined" style="vertical-align:middle;">edit</span>
        Customise
      </button>
    </div>
  </div>

  <!-- 2. Live Tab -->
  <div class="tab-content" id="liveTab">
    <div class="live-grid" id="liveGrid">
      <!-- Populated by JS or skeleton placeholders -->
    </div>
  </div>

  <!-- 3. Notes Tab -->
  <div class="tab-content" id="notesTab">
    <div class="notes-content">
      Under development...
    </div>
  </div>

</div>

<!-- Modal for password if not in URL -->
<div class="modal-backdrop" id="passwordModal" style="display: none;">
  <div class="modal">
    <h3>Enter Password</h3>
    <input type="password" id="passwordField" />
    <button id="passwordSubmitBtn">Submit</button>
  </div>
</div>

<script>
/* ===========================================================
   Utility / Mock / Placeholder Functions
   =========================================================== */

/**
 * Mock function to decrypt the API URL using the password.
 * Replace with your real decryption method.
 */
function decryptUrl(encryptedUrl, password) {
  // For demonstration, assume the "encryptedUrl" is plain text
  // and we just return it if password is correct.
  // In real usage, you'd apply actual cryptographic logic.
  return encryptedUrl;
}

/**
 * Simple helper to get URL params by name
 */
function getUrlParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

/* ===========================================================
   Password Check & Modal
   =========================================================== */
const passwordModal = document.getElementById('passwordModal');
const passwordField = document.getElementById('passwordField');
const passwordSubmitBtn = document.getElementById('passwordSubmitBtn');

// Check if password param is in URL
let password = getUrlParam('password');
if (!password) {
  // Show modal
  passwordModal.style.display = 'flex';
  setTimeout(() => {
    passwordField.focus();
  }, 50);
} else {
  // We have a password param, proceed
  // decrypt the API URL or do any needed initialization
  initApp();
}

passwordSubmitBtn.addEventListener('click', () => {
  const enteredPass = passwordField.value.trim();
  if (enteredPass) {
    // Reload the page with the password param
    const newUrl = new URL(window.location.href);
    newUrl.searchParams.set('password', enteredPass);
    window.location.href = newUrl.toString();
  }
});

/* ===========================================================
   Tabs Switching
   =========================================================== */
const tabButtons = document.querySelectorAll('.tab-button');
const tabContents = document.querySelectorAll('.tab-content');

tabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    // Deactivate all tabs
    tabButtons.forEach(b => b.classList.remove('active'));
    tabContents.forEach(tc => tc.classList.remove('active'));

    // Activate the clicked tab
    btn.classList.add('active');
    const tabName = btn.getAttribute('data-tab');
    document.getElementById(tabName + 'Tab').classList.add('active');
  });
});

/* ===========================================================
   DPAD / Key Handling (fast-forward key = 90)
   =========================================================== */
document.addEventListener('keydown', (e) => {
  if (e.keyCode === 90) {
    // Keycode 90 pressed (Android fast-forward)
    // We can run a special function if an element is focused
    const focused = document.activeElement;
    if (focused && focused.dataset && focused.dataset.link) {
      // If the item has a data-link, handle fast-forward action
      handleItemSelect('fastForward', focused.dataset.link);
    }
  }
});

/* ===========================================================
   App Initialization after password is found
   =========================================================== */
function initApp() {
  // In real usage, decrypt the actual API endpoint with the password:
  const encryptedApiUrl = 'https://example.com/api'; // placeholder
  const realApiUrl = decryptUrl(encryptedApiUrl, password);

  // Start building out the skeletons, then fetch data
  buildSkeletons();

  // Load quick links for Saved tab
  loadQuickLinks(realApiUrl);

  // Load Live tab data
  loadLiveLinks(realApiUrl);
}

/* ===========================================================
   Skeleton Builders
   =========================================================== */
function buildSkeletons() {
  // Saved Tab skeleton (quick links)
  const quickLinksContainer = document.getElementById('quickLinks');
  for (let i = 0; i < 5; i++) {
    const skel = document.createElement('div');
    skel.classList.add('quick-link', 'skeleton');
    quickLinksContainer.appendChild(skel);
  }

  // Live tab skeleton
  const liveGrid = document.getElementById('liveGrid');
  for (let i = 0; i < 6; i++) {
    const tile = document.createElement('div');
    tile.classList.add('live-tile', 'skeleton');

    const imgDiv = document.createElement('div');
    imgDiv.classList.add('live-tile-img');
    tile.appendChild(imgDiv);

    const titleDiv = document.createElement('div');
    titleDiv.classList.add('live-tile-title');
    titleDiv.style.height = '1rem';
    tile.appendChild(titleDiv);

    const metaDiv = document.createElement('div');
    metaDiv.classList.add('live-tile-meta');
    metaDiv.style.height = '0.8rem';
    tile.appendChild(metaDiv);

    liveGrid.appendChild(tile);
  }
}

/* ===========================================================
   Loading & Rendering: Saved Tab
   =========================================================== */
function loadQuickLinks(apiUrl) {
  // Simulate a fetch from your real endpoint
  // setTimeout to simulate network
  setTimeout(() => {
    // Remove skeleton
    const quickLinksContainer = document.getElementById('quickLinks');
    quickLinksContainer.innerHTML = '';

    // Mock data
    const data = [
      { name: 'Google', link: 'https://google.com', icon: 'https://www.google.com/favicon.ico' },
      { name: 'GitHub', link: 'https://github.com', icon: 'https://github.githubassets.com/favicons/favicon.png' },
      { name: 'Stack', link: 'https://stackoverflow.com', icon: 'https://stackoverflow.com/favicon.ico' },
      { name: 'Reddit', link: 'https://reddit.com', icon: 'https://www.redditstatic.com/desktop2x/img/favicon/favicon-32x32.png' },
    ];

    data.forEach((item, index) => {
      const ql = document.createElement('div');
      ql.classList.add('quick-link');
      ql.tabIndex = 5 + index; // set tab index (just an example)
      ql.draggable = false; // will enable in edit mode
      ql.dataset.link = item.link; // store the link for DPAD / fastForward usage

      // Icon container
      const iconCont = document.createElement('div');
      iconCont.classList.add('icon-container');
      const iconImg = document.createElement('img');
      iconImg.src = item.icon;
      iconCont.appendChild(iconImg);

      // Text
      const textDiv = document.createElement('div');
      textDiv.classList.add('ql-text');
      textDiv.textContent = item.name;

      // Build structure
      ql.appendChild(iconCont);
      ql.appendChild(textDiv);

      // Handle normal click
      ql.addEventListener('click', () => {
        handleItemSelect('click', item.link);
      });

      quickLinksContainer.appendChild(ql);
    });
  }, 1000);
}

/* ===========================================================
   Loading & Rendering: Live Tab
   =========================================================== */
function loadLiveLinks(apiUrl) {
  // Simulate a fetch from your real endpoint
  setTimeout(() => {
    // Remove skeleton
    const liveGrid = document.getElementById('liveGrid');
    liveGrid.innerHTML = '';

    // Mock data
    const data = [
      {
        title: 'Cool Article',
        link: 'https://example.com/article',
        ogImage: 'https://via.placeholder.com/200x100?text=OG+Image',
        device: 'Desktop Chrome',
        time: '2025-03-28 10:00'
      },
      {
        title: 'Another Link',
        link: 'https://example.com/something',
        ogImage: 'https://via.placeholder.com/200x100?text=OG+Image2',
        device: 'Mobile',
        time: '2025-03-28 09:55'
      }
    ];

    data.forEach((item, index) => {
      const tile = document.createElement('div');
      tile.classList.add('live-tile');
      tile.tabIndex = 10 + index;
      tile.dataset.link = item.link;

      // Image
      const imgDiv = document.createElement('div');
      imgDiv.classList.add('live-tile-img');
      const ogImg = document.createElement('img');
      ogImg.src = item.ogImage;
      imgDiv.appendChild(ogImg);

      // Title
      const titleDiv = document.createElement('div');
      titleDiv.classList.add('live-tile-title');
      titleDiv.textContent = item.title;

      // Meta
      const metaDiv = document.createElement('div');
      metaDiv.classList.add('live-tile-meta');
      metaDiv.textContent = `Device: ${item.device} | Time: ${item.time}`;

      // Build structure
      tile.appendChild(imgDiv);
      tile.appendChild(titleDiv);
      tile.appendChild(metaDiv);

      // Handle normal click
      tile.addEventListener('click', () => {
        handleItemSelect('click', item.link);
      });

      liveGrid.appendChild(tile);
    });
  }, 1500);
}

/* ===========================================================
   Handling Click vs FastForward
   =========================================================== */
function handleItemSelect(eventType, link) {
  if (eventType === 'click') {
    // Normal click -> open link
    window.open(link, '_blank');
  } else if (eventType === 'fastForward') {
    // Fast-forward key pressed -> do something else
    console.log('Fast-forward event on link:', link);
    // e.g. show a context menu, or load preview, etc.
    alert('Fast-forward key event triggered for ' + link);
  }
}

/* ===========================================================
   Edit / Customize Mode for Quick Links
   =========================================================== */
const customiseBtn = document.getElementById('customiseBtn');
const quickLinksContainer = document.getElementById('quickLinks');
const dropZone = document.getElementById('dropZone');

let editMode = false;
let draggedItem = null;

customiseBtn.addEventListener('click', () => {
  editMode = !editMode;
  if (editMode) {
    customiseBtn.textContent = 'Done';
    enableEditMode();
  } else {
    customiseBtn.textContent = 'Customise';
    disableEditMode();
    // TODO: POST updated order to API, if needed
  }
});

function enableEditMode() {
  // Show dropZone or any instructions
  dropZone.classList.add('edit-mode');
  // Make quick-links draggable
  Array.from(quickLinksContainer.children).forEach(linkEl => {
    linkEl.draggable = true;
    linkEl.style.cursor = 'grab';
    linkEl.addEventListener('dragstart', onDragStart);
    linkEl.addEventListener('dragend', onDragEnd);
    linkEl.addEventListener('dragover', onDragOver);
    linkEl.addEventListener('drop', onDrop);
  });
}

function disableEditMode() {
  dropZone.classList.remove('edit-mode');
  Array.from(quickLinksContainer.children).forEach(linkEl => {
    linkEl.draggable = false;
    linkEl.style.cursor = 'pointer';
    linkEl.removeEventListener('dragstart', onDragStart);
    linkEl.removeEventListener('dragend', onDragEnd);
    linkEl.removeEventListener('dragover', onDragOver);
    linkEl.removeEventListener('drop', onDrop);
  });
}

function onDragStart(e) {
  draggedItem = this;
  this.classList.add('dragging');
}

function onDragEnd(e) {
  draggedItem = null;
  this.classList.remove('dragging');
}

function onDragOver(e) {
  e.preventDefault();
  const afterElement = getDragAfterElement(quickLinksContainer, e.clientY);
  if (!afterElement) {
    quickLinksContainer.appendChild(draggedItem);
  } else {
    quickLinksContainer.insertBefore(draggedItem, afterElement);
  }
}

function onDrop(e) {
  e.preventDefault();
}

/**
 * Helper to figure out the correct place to drop the dragged item.
 */
function getDragAfterElement(container, y) {
  const draggableElements = [...container.querySelectorAll('.quick-link:not(.dragging)')];
  return draggableElements.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = y - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) {
      return { offset: offset, element: child };
    } else {
      return closest;
    }
  }, { offset: Number.NEGATIVE_INFINITY }).element;
}
</script>

</body>
</html>
